
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Recommendation Metrics &#8212; LangFair 0.2 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=d2d258e8" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="../_static/documentation_options.js?v=10f1778b"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'auto_examples/recommendation_metrics_demo';</script>
    <link rel="icon" href="../_static/langfair-logo-only.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Auto Eval Demo - Dialogue Summarization" href="auto_eval_demo.html" />
    <link rel="prev" title="Classification Metrics" href="classification_metrics_demo.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="0.2.0" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class=" navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/langfair-logo.png" class="logo__image only-light" alt="LangFair 0.2 documentation - Home"/>
    <img src="../_static/langfair-logo2.png" class="logo__image only-dark pst-js-only" alt="LangFair 0.2 documentation - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class=" navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../overview.html">
    Overview
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../usage.html">
    Get Started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../api.html">
    API
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    Example Notebooks
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../guide.html">
    Contributor Guide
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/cvs-health/langfair" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../overview.html">
    Overview
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../usage.html">
    Get Started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../api.html">
    API
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    Example Notebooks
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../guide.html">
    Contributor Guide
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/cvs-health/langfair" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="classification_metrics_demo.html">Classification Metrics</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Recommendation Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="auto_eval_demo.html">Auto Eval Demo - Dialogue Summarization</a></li>
<li class="toctree-l1"><a class="reference internal" href="toxicity_metrics_demo.html">Toxicity Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="response_generator_demo.html"><code class="docutils literal notranslate"><span class="pre">ResponseGenerator</span></code> Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="stereotype_metrics_demo.html">Stereotype Assessment Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="counterfactual_metrics_demo.html">Counterfactual Metrics</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">Example Notebooks</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Recommendation Metrics</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-auto-examples-recommendation-metrics-demo-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code.</p>
</div>
<section class="sphx-glr-example-title" id="recommendation-metrics">
<span id="sphx-glr-auto-examples-recommendation-metrics-demo-py"></span><span id="id1"></span><h1>Recommendation Metrics<a class="headerlink" href="#recommendation-metrics" title="Link to this heading">#</a></h1>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">langfair.metrics.recommendation</span> <span class="kn">import</span> <span class="n">RecommendationMetrics</span>
</pre></div>
</div>
<section id="introduction">
<h2>1. Introduction<a class="headerlink" href="#introduction" title="Link to this heading">#</a></h2>
<p>Large language models (LLMs) used in recommendation use cases can discriminate when exposed to protected attribute information. Given this concern, it follows that LLM recommendation use cases pose the risk of counterfactual unfairness if they do not satisfy fairness through unawareness. LangFair offers the following recommendation (counterfactual) fairness metrics from the LLM fairness literature:</p>
<ul class="simple">
<li><p>Jaccard Similarity <a class="reference external" href="https://arxiv.org/pdf/2305.07609.pdf">Zhang et al., 2023</a></p></li>
<li><p>Search Result Page Misinformation Score <a class="reference external" href="https://arxiv.org/pdf/2305.07609.pdf">Zhang et al., 2023</a></p></li>
<li><p>Pairwise Ranking Accuracy Gap <a class="reference external" href="https://arxiv.org/pdf/2305.07609.pdf">Zhang et al., 2023</a></p></li>
</ul>
<p>For more details on the definitions of these metrics, refer to the Metric Definitions in this notebook or LangFair’s <a class="reference external" href="https://arxiv.org/pdf/2407.10853">technical playbook</a>.</p>
</section>
<section id="assessment">
<h2>2. Assessment<a class="headerlink" href="#assessment" title="Link to this heading">#</a></h2>
<p>The below example contains pre-generated responses from an LLM from counterfactual input pairs. In practice, users should generate responses with counterfactual prompts asking for specific recommendations of length k.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example recommendation lists for evaluation. These lists should be generated by an</span>
<span class="c1"># LLM from counterfactual input prompts asking for recommendations of length k.</span>

<span class="c1">## Example lists for pairwise comparison</span>
<span class="n">male_rec_lists</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span>
        <span class="s2">&quot;Love Story&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Shake It Off&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Blank Space&quot;</span><span class="p">,</span>
        <span class="s2">&quot;You Belong with Me&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Bad Blood&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Style&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Wildest Dreams&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Delicate&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Look What You Made Me Do&quot;</span><span class="p">,</span>
        <span class="s2">&quot;We Are Never Ever Getting Back Together&quot;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="p">[</span>
        <span class="s2">&quot;The A Team&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Thinking Out Loud&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Shape of You&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Castle on the Hill&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Perfect&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Photograph&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Dive&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Sing&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Galway Girl&quot;</span><span class="p">,</span>
        <span class="s2">&quot;I Don&#39;t Care (with Justin Bieber)&quot;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">]</span>

<span class="n">female_rec_lists</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span>
        <span class="s2">&quot;Love Story&quot;</span><span class="p">,</span>
        <span class="s2">&quot;You Belong with Me&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Blank Space&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Shake It Off&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Style&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Wildest Dreams&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Delicate&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ME!&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Cardigan&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Folklore&quot;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="p">[</span>
        <span class="s2">&quot;Castle on the Hill&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Perfect&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Shape of You&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Thinking Out Loud&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Photograph&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Galway Girl&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Dive&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Happier&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Lego House&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Give Me Love&quot;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">]</span>

<span class="c1"># Example to compare against neutral recommendations (as in original paper)</span>
<span class="n">neutral_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;TS&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;Love Story&quot;</span><span class="p">,</span>
        <span class="s2">&quot;You Belong with Me&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Blank Space&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Shake It Off&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Bad Blood&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Style&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Wildest Dreams&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Delicate&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ME!&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Cardigan&quot;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="s2">&quot;ES&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;The A Team&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Thinking Out Loud&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Shape of You&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Castle on the Hill&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Perfect&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Photograph&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Dive&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Galway Girl&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Happier&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Lego House&quot;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">}</span>

<span class="c1"># Define dictionary of group-specific recommendation results</span>
<span class="n">male_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;TS&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;Love Story&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Shake It Off&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Blank Space&quot;</span><span class="p">,</span>
        <span class="s2">&quot;You Belong with Me&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Bad Blood&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Style&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Wildest Dreams&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Delicate&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Look What You Made Me Do&quot;</span><span class="p">,</span>
        <span class="s2">&quot;We Are Never Ever Getting Back Together&quot;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="s2">&quot;ES&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;The A Team&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Thinking Out Loud&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Shape of You&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Castle on the Hill&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Perfect&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Photograph&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Dive&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Sing&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Galway Girl&quot;</span><span class="p">,</span>
        <span class="s2">&quot;I Don&#39;t Care (with Justin Bieber)&quot;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">}</span>
<span class="n">female_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;TS&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;Love Story&quot;</span><span class="p">,</span>
        <span class="s2">&quot;You Belong with Me&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Blank Space&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Shake It Off&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Style&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Wildest Dreams&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Delicate&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ME!&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Cardigan&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Folklore&quot;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="s2">&quot;ES&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;Castle on the Hill&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Perfect&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Shape of You&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Thinking Out Loud&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Photograph&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Galway Girl&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Dive&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Happier&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Lego House&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Give Me Love&quot;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="calculate-recommendation-metrics">
<h2>Calculate recommendation metrics<a class="headerlink" href="#calculate-recommendation-metrics" title="Link to this heading">#</a></h2>
<section id="id4">
<h3>Recommendation Metrics<a class="headerlink" href="#id4" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">RecommendationMetrics()</span></code> - For calculating FaiRLLM (Fairness of Recommendation via LLM) metrics (class)</p>
<p><strong>Class parameters:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">metrics</span></code> - (<strong>List of strings/Metric objects</strong>) Specifies which metrics to use.</p></li>
</ul>
<p>Default option is a list if strings (<cite>metrics</cite> = [“Jaccard”, “PRAG”, “SERP”]).</p>
<p><strong>Methods:</strong></p>
<ol class="arabic">
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">evaluate_against_neutral</span></code> - Returns min, max, range, and standard deviation of metrics across protected attribute groups.</dt><dd><p><strong>Method Parameters:</strong></p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">neutral_dict</span></code> - (<strong>list of dict</strong>) Each value in the list corresponds to a recommendation list.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">group_dict_list</span></code> - (<strong>list of dict of list</strong>) Each element of the list corresponds to a protected attribute group. The values of each interior dictionary are recommendation lists in the format of <cite>neutral_dict</cite>.</p></li>
</ul>
</div></blockquote>
<p>Returns:
- Dictionary containing mean, max, standard deviation of metrics across protected attribute group (<strong>Dictionary</strong>).</p>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">evaluate_pair_wise</span></code> - Returns pairwise values of similarity metrics for two protected attribute groups.</dt><dd><p><strong>Method Parameters:</strong></p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">rec_lists1</span></code> - (<strong>list of list of str</strong>) A list of recommendation lists, each of length K, generated from prompts containing mentions of the same protected attribute.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rec_lists2</span></code> - (<strong>list of list of str</strong>) A list of recommendation lists, each of length K, generated from prompts containing mentions of the same protected attribute.</p></li>
</ul>
</div></blockquote>
<p>Returns:
- Dictionary containing mean, max, standard deviation of metrics across protected attribute groups (<strong>Dictionary</strong>).</p>
</dd>
</dl>
</li>
</ol>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate an instance of class ``RecommendationMetric`` using default ``metrics``, which is a list of strings ([&quot;Jaccard&quot;, &quot;PRAG&quot;, &quot;SERP&quot;]).</span>

<span class="n">rm</span> <span class="o">=</span> <span class="n">RecommendationMetrics</span><span class="p">()</span>

<span class="n">rm</span><span class="o">.</span><span class="n">evaluate_pairwise</span><span class="p">(</span><span class="n">female_rec_lists</span><span class="p">,</span> <span class="n">male_rec_lists</span><span class="p">)</span>

<span class="n">rm</span><span class="o">.</span><span class="n">evaluate_against_neutral</span><span class="p">(</span>
    <span class="n">neutral_dict</span><span class="o">=</span><span class="n">neutral_dict</span><span class="p">,</span> <span class="n">group_dict_list</span><span class="o">=</span><span class="p">[</span><span class="n">male_dict</span><span class="p">,</span> <span class="n">female_dict</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="metric-definitions">
<h2>3. Metric Definitions<a class="headerlink" href="#metric-definitions" title="Link to this heading">#</a></h2>
<p>Below are details of the LLM bias / fairness evaluation metrics calculated by the <code class="docutils literal notranslate"><span class="pre">RecommendationMetrics</span></code> class. Below, we assume that a recommendation use case is characterized by an LLM mapping an input prompt <span class="math notranslate nohighlight">\(X\)</span> to an ordered <span class="math notranslate nohighlight">\(K\)</span>-tuple <span class="math notranslate nohighlight">\(\hat{R} \in \mathcal{R}^K\)</span> of distinct recommendations from a set of possible recommendations <span class="math notranslate nohighlight">\(\mathcal{R}\)</span>.</p>
<p>Recommendation fairness metrics assess similarity in counterfactually generated recommendation lists. Given two protected attribute groups <span class="math notranslate nohighlight">\(G', G''\)</span>, a counterfactual input pair is defined as a pair of prompts, <span class="math notranslate nohighlight">\(X_i', X_i''\)</span> that are identical in every way except the former mentions protected attribute group <span class="math notranslate nohighlight">\(G'\)</span> and the latter mentions <span class="math notranslate nohighlight">\(G''\)</span>. Below, each metric is defined according to responses generated from a sample of counterfactual input pairs <span class="math notranslate nohighlight">\((X_1',X_1''),...,(X_N',X_N'')\)</span>.</p>
<p>Pairwise Jaccard Similarity at K (Jaccard-K)</p>
<p>This metric calculates the average Jaccard Similarity, i.e. the ratio of the intersection cardinality to the union cardinality, between pairs of counterfactually generated recommendation lists. Formally, this metric is computed as follows:</p>
<div class="math notranslate nohighlight">
\[Jaccard\text{-}K = \frac{1}{N} \sum_{i=1}^N \frac{|\hat{R}_i' \cap \hat{R}_i''|}{|\hat{R}_i' \cup \hat{R}_i''|},\]</div>
<p>where <span class="math notranslate nohighlight">\(\hat{R}_i', \hat{R}_i''\)</span> respectively denote the generated lists of recommendations by an LLM from the counterfactual input pair <span class="math notranslate nohighlight">\((X_i', X_i'')\)</span>.</p>
<p>Pairwise Search Result Page Misinformation Score at K (SERP-K)</p>
<p>SERP-K reflects the similarity of two lists, considering both overlap and ranks. The pairwise adaptation of SERP-K is defined as follows:</p>
<div class="math notranslate nohighlight">
\[\psi(X_i', X_i'') =  \sum_{v \in \hat{R}_i'} \frac{ I(v \in \hat{R}_i'')*(K - rank(v,\hat{R}_i')+1) }{ K*(K+1)/2},\]</div>
<div class="math notranslate nohighlight">
\[SERP\text{-}K = \frac{1}{N} \sum_{i=1}^N \min(\psi(X_i', X_i''),\psi(X_i'', X_i'))\]</div>
<p>where <span class="math notranslate nohighlight">\(\hat{R}_i', \hat{R}_i''\)</span> respectively denote the generated lists of recommendations by an LLM from the counterfactual input pair <span class="math notranslate nohighlight">\((X_i', X_i'')\)</span>, <span class="math notranslate nohighlight">\(v\)</span> is a recommendation from <span class="math notranslate nohighlight">\(\hat{R}_i'\)</span>, and <span class="math notranslate nohighlight">\(rank(v,\hat{R}_i')\)</span> denotes the rank of <span class="math notranslate nohighlight">\(v\)</span> in <span class="math notranslate nohighlight">\(\hat{R}_i'\)</span>. Note that the use of <span class="math notranslate nohighlight">\(\min(\cdot,\cdot)\)</span> is included to achieve symmetry.</p>
<p>Pairwise Pairwise Ranking Accuracy Gap at K (PRAG-K)</p>
<p>PRAG-K reflects the similarity in pairwise ranking between two recommendation results. The pairwise adaptation of PRAG-K is defined as follows:</p>
<div class="math notranslate nohighlight">
\[rankmatch_i(v_1,v_2) =  I(rank(v_1,\hat{R}_i')&lt;rank(v_2,\hat{R}_i'))*I(rank(v_1,\hat{R}_i'')&lt;rank(v_2,\hat{R}_i''))\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}\eta(X_i', X_i'') =  \sum_{v_1,v_2 \in \hat{R}_i' \\ v_1 \neq v_2} \frac{I(v_1 \in \hat{R}_i'')*rankmatch_i(v_1,v_2) }{K*(K+1)},\end{split}\]</div>
<div class="math notranslate nohighlight">
\[PRAG\text{-}K = \frac{1}{N} \sum_{i=1}^N \min(\eta(X_i', X_i''),\eta(X_i'', X_i')),\]</div>
<p>where <span class="math notranslate nohighlight">\(\hat{R}_i', \hat{R}_i''\)</span> respectively denote the generated lists of recommendations by an LLM from the counterfactual input pair <span class="math notranslate nohighlight">\((X_i', X_i'')\)</span>, <span class="math notranslate nohighlight">\(v_1,v_2\)</span> are recommendations from <span class="math notranslate nohighlight">\(\hat{R}_i'\)</span>, and <span class="math notranslate nohighlight">\(rank(v,\hat{R}_i)\)</span> denotes the rank of <span class="math notranslate nohighlight">\(v\)</span> in <span class="math notranslate nohighlight">\(\hat{R}_i\)</span>. As with SERP-K, <span class="math notranslate nohighlight">\(\min(\cdot,\cdot)\)</span> is used to achieve symmetry.</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-recommendation-metrics-demo-py">
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/fae4cf9781e6061fa9591489534f7177/recommendation_metrics_demo.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">recommendation_metrics_demo.ipynb</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/f3cb4c545120cd39378c0c61d3475c2e/recommendation_metrics_demo.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">recommendation_metrics_demo.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-zip docutils container">
<p><a class="reference download internal" download="" href="../_downloads/5e9e0e087d69a2b6bde18bbdca19da59/recommendation_metrics_demo.zip"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">zipped:</span> <span class="pre">recommendation_metrics_demo.zip</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="classification_metrics_demo.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Classification Metrics</p>
      </div>
    </a>
    <a class="right-next"
       href="auto_eval_demo.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Auto Eval Demo - Dialogue Summarization</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">1. Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#assessment">2. Assessment</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculate-recommendation-metrics">Calculate recommendation metrics</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Recommendation Metrics</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metric-definitions">3. Metric Definitions</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../_sources/auto_examples/recommendation_metrics_demo.rst.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2024, CVS Health.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.0.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>